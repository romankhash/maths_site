<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>МАТЕМАТИЧНИЙ ТРЕНАЖЕР</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background: linear-gradient(180deg,#071029 0%, #000044 60%);
            background-repeat: no-repeat;
            min-height: 100vh;
        }
        header {
            padding: 40px 20px;
            color: rgb(255, 225, 184);
            background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            box-shadow: 0 6px 30px rgba(2,6,23,0.6);
        }
        .container {
            padding: 20px;
        }
        .btn {
            display: inline-block;
            margin: 10px;
            padding: 12px 20px;
            background: linear-gradient(135deg,#ffb86b, #ff7ab6);
            color: #000000;
            text-decoration: none;
            border-radius: 10px;
            font-size: 16px;
            transition: 0.2s;
            cursor: pointer;
            border: none;
        }
        .btn:hover {
            background: #3a68b5;
        }
        .topics {
            display: none;
            margin-top: 20px;
        }
        .topic-btns {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            max-width: 800px;
            margin: auto;
        }
        .bottom-test {
            margin-top: 25px;
        }
        #theoryBox {
            display:none;
            padding:15px;
            max-width:700px;
            margin: 20px auto;
            background: linear-gradient(135deg, #F08080, #D8BFD8);
            border-radius:10px;
            box-shadow:0 0 10px rgba(0,0,0,0.12);
            text-align:left;
        }
        #exampleBox, #finalTestBox {
            display:none;
            margin: 20px auto;
            max-width: 900px;
            text-align:left;
            background: linear-gradient(180deg, #000044,#071029);
            color:black;
            padding:15px;
            border-radius:10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.08);
        }
        .example {
            margin-bottom: 14px;
            padding: 8px;
            border-radius: 8px;
            background: linear-gradient(270deg, #e924ff, #d0877b);
        }
        #exampleText{
            color:rgb(253, 240, 221);
        }
        #checkBtn{
            background: #9090fb;
            color:#000044;  
        }
        #finalTestText{
            color:antiquewhite;
        }
        #finalTestText1{
            color:blanchedalmond;
        }

        label { display:block; margin:6px 0; font-size:16px; cursor:pointer; }
        .hr { height:1px; background:#e0e0e0; margin:14px 0; border-radius:2px; }
        .small { font-size:14px; color:#555; }
        .muted { color:#777; font-size:14px; }
    </style>
</head>
<body>
    <header>
        <h1>МАТЕМАТИЧНИЙ ТРЕНАЖЕР</h1>
        <p>На цьому сайті ти можеш попрактикувати свої знання з математики!</p>
    </header>

    <div class="container">
        <button id="startBtn" class="btn">Почати</button>

        <div id="topics" class="topics">
            <div class="topic-btns">
                <button class="btn topic-btn" data-topic="add-sub" onclick="openTopicAndTheory('add-sub')">Додавання / Віднімання</button>
                <button class="btn topic-btn" data-topic="mul-div" onclick="openTopicAndTheory('mul-div')">Множення / Ділення</button>
                <button class="btn topic-btn" data-topic="ineq" onclick="openTopicAndTheory('ineq')">Нерівності</button>
            </div>
            <div class="bottom-test">
                <button id="finalTestBtn" class="btn" onclick="openFinalTest()">Підсумковий тест</button>
            </div>
        </div>
    </div>

    <div id="theoryBox">
        <h2 id="theoryTitle">Теорія</h2>
        <p id="theoryText"></p>
        <div style="text-align:right; margin-top:8px;">
            <button id="openTheoryBtn" class="btn" style="display:none;" onclick="reopenTheory()">Показати теорію</button>
            <button id="closeTheoryBtn" class="btn" onclick="closeTheory()">Закрити</button>
        </div>
    </div>

    <div style="text-align:center; margin-top:10px;">
        <button id="practiceBtn" class="btn" style="display:none;" onclick="startPractice()">Почати практикуватись</button>
        <button id="backBtn" class="btn" style="display:none;" onclick="goBack()">На головну</button>
    </div>

    <div id="exampleBox">
        <h2 id="exampleText">Приклади</h2>

        <div id="practiceExamples">
        </div>

        <div style="text-align:center; margin-top:12px;">
            <button id="checkAllBtn" class="btn" onclick="checkAllExamples()" style="display:none;">На головну</button>
        </div>
    </div>

    <div id="finalTestBox">
        <h2 id="finalTestText">Підсумковий тест</h2>
        <p class="muted" id="finalTestText1">У тесті міститься 4 приклади з кожної теми. Кожен приклад оцінюється в 1 бал.</p>
        <div id="finalQuestions">
        </div>
        <div style="text-align:center; margin-top:12px;">
            <button id="checkFinalBtn" class="btn" onclick="checkFinalTest()">ПЕРЕВІРИТИ ТЕСТ</button>
        </div>
    </div>

<script>
const theory = {
    'add-sub': {
        title: 'Додавання / Віднімання',
        text: 'Якщо є рівняння виду a + x = b, щоб знайти x - переноси a праворуч із зміною знака: x = b - a. Аналогічно для віднімання: якщо a - x = b, то x = a - b.'
    },
    'mul-div': {
        title: 'Множення / Ділення',
        text: 'Якщо рівняння виглядає a * x = b, то x = b / a. Якщо a / x = b, то x = a / b. Потрібно слідкувати, щоб ділення було цілим (без дробів), якщо хочемо ціле рішення.'
    },
    'ineq': {
        title: 'Нерівності',
        text: 'При нерівностях а + x > b — треба знайти x таке, що x > b - a. Мінімальне ціле значення x = (b - a) + 1. При x - a > b — x > a + b, мінімальне ціле x = a + b + 1.'
    }
};

let completedTopics = {}; 
let currentTopic = '';
let correctAnswers = {};
let finalTestData = [];

document.getElementById('startBtn').onclick = () => {
    document.getElementById('topics').style.display = 'block';
    document.getElementById('startBtn').style.display = 'none';
};

function openTopicAndTheory(topic) {
    if (completedTopics[topic]) {
        alert('Цю тему вже завершено.');
        return;
    }
    currentTopic = topic;
    document.getElementById('theoryTitle').innerText = theory[topic].title;
    document.getElementById('theoryText').innerText = theory[topic].text;
    document.getElementById('theoryBox').style.display = 'block';
    document.getElementById('practiceBtn').style.display = 'inline-block';
    document.getElementById('backBtn').style.display = 'inline-block';
    document.getElementById('topics').style.display = 'none';
    document.getElementById('exampleBox').style.display = 'none';
    document.getElementById('openTheoryBtn').style.display = 'none';
    document.getElementById('closeTheoryBtn').style.display = 'none';
}

function reopenTheory(){
    document.getElementById('theoryBox').style.display = 'block';
    document.getElementById('openTheoryBtn').style.display = 'none';
}
function closeTheory(){
    document.getElementById('theoryBox').style.display = 'none';
    document.getElementById('openTheoryBtn').style.display = 'inline-block';
}

function goBack(){
    document.getElementById('topics').style.display = 'block';
    document.getElementById('backBtn').style.display = 'none';
    document.getElementById('practiceBtn').style.display = 'none';
    document.getElementById('exampleBox').style.display = 'none';
    document.getElementById('theoryBox').style.display = 'none';
    document.getElementById('checkAllBtn').style.display = 'none';
    document.getElementById('finalTestBox').style.display = 'none';
    document.getElementById('finalQuestions').style.display = 'none';
    document.getElementById('checkFinalBtn').style.display = 'none';
    correctAnswers = {};
    document.getElementById('practiceExamples').innerHTML = '';
}

function startPractice() {
    document.getElementById('exampleBox').style.display = 'block';
    document.getElementById('checkAllBtn').style.display = 'inline-block';
    document.getElementById('theoryBox').style.display = 'block';
    document.getElementById('openTheoryBtn').style.display = 'none';
    document.getElementById('practiceBtn').style.display = 'none';
    document.getElementById('backBtn').style.display = 'none';

    const ranges = [
        {min:1, max:20},
        {min:20, max:100},
        {min:100, max:500}
    ];
    correctAnswers = {};
    document.getElementById('practiceExamples').innerHTML = '';
    for (let i=0;i<3;i++){
        const exNum = i+1;
        const rng = ranges[i];
        const ex = generatePracticeExample(currentTopic, rng.min, rng.max);
        correctAnswers[exNum] = ex.correct;
        renderPracticeExample(exNum, ex);
    }
}

function generatePracticeExample(topic, min, max){
    if (topic === 'add-sub') {

        let a = randInt(min, max);
        let b = randInt(min, max);
        if (b <= a) b = a + randInt(1, Math.max(1, max - a));
        const correct = b - a;
        const text = `${a} + x = ${b}`;
        const answers = makeOptions(correct);
        return {text, answers, correct};
    } else if (topic === 'mul-div') {
        if (Math.random() < 0.5) {
            const a = randInt(2, 12);
            const x = randInt(1, 12);
            const b = a * x;
            const text = `${a} · x = ${b}`;
            const correct = x;
            const answers = makeOptions(correct);
            return {text, answers, correct};
        } else {
            const b = randInt(1, 12);
            const x = randInt(1, 12);
            const a = b * x;
            const text = `${a} : x = ${b}`;
            const correct = x;
            const answers = makeOptions(correct);
            return {text, answers, correct};
        }
    } else if (topic === 'ineq') {
        if (Math.random() < 0.5) {
            const a = randInt(min, Math.max(min+1, Math.floor((min+max)/4)));
            const b = randInt(a+1, max+20);
            const minimal = (b - a) + 1;
            const text = `Знайди найменше ціле x, що задовольняє: ${a} + x > ${b}`;
            const correct = minimal;
            const answers = makeOptions(correct);
            return {text, answers, correct};
        } else {
            const a = randInt(min, Math.min(max, Math.floor((min+max)/4)));
            const b = randInt(min, Math.max(min+1, Math.floor((min+max)/3)));
            const minimal = a + b + 1;
            const text = `Знайди найменше ціле x, що задовольняє: x - ${a} > ${b}`;
            const correct = minimal;
            const answers = makeOptions(correct);
            return {text, answers, correct};
        }
    }
}

function makeOptions(correct) {
    const set = new Set();
    set.add(correct);
    let span = Math.max(1, Math.floor(Math.abs(correct) * 0.3) + 1);

    while (set.size < 3) {
        const delta = randInt(1, Math.max(3, span));
        const sign = Math.random() < 0.5 ? -1 : 1;
        let val = correct + sign*delta;
        set.add(val);
        if (set.size >= 10) break;
    }
    const arr = Array.from(set);
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr.slice(0,3);
}

function renderPracticeExample(num, ex) {
    const container = document.getElementById('practiceExamples');
    const div = document.createElement('div');
    div.className = 'example';
    div.id = `example${num}`;

    const p = document.createElement('p');
    p.style.fontSize = '20px';
    p.style.fontWeight = '600';
    p.innerText = ex.text;
    div.appendChild(p);

    const optionsDiv = document.createElement('div');
    optionsDiv.id = `answerOptions${num}`;
    ex.answers.forEach(opt => {
        const label = document.createElement('label');
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = `answer${num}`;
        radio.value = opt;
        radio.style.marginRight = '8px';
        label.appendChild(radio);
        label.appendChild(document.createTextNode(opt));
        optionsDiv.appendChild(label);
    });
    div.appendChild(optionsDiv);

    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.id = 'checkBtn'
    btn.innerText = 'Перевірити';
    btn.onclick = () => checkSelectedAnswer(num);
    div.appendChild(btn);

    const resultP = document.createElement('p');
    resultP.id = `result${num}`;
    resultP.style.fontSize = '18px';
    resultP.style.marginTop = '8px';
    div.appendChild(resultP);

    container.appendChild(div);
}

function checkSelectedAnswer(exampleNum) {
    const selected = document.querySelector(`input[name="answer${exampleNum}"]:checked`);
    const result = document.getElementById(`result${exampleNum}`);
    if (!selected) {
        result.innerText = 'Оберіть відповідь!';
        result.style.color = 'black';
        return;
    }
    const correct = correctAnswers[exampleNum];
    if (parseInt(selected.value) === correct) {
        result.innerText = 'Молодець!';
        result.style.color = 'black';
        const radios = document.querySelectorAll(`input[name="answer${exampleNum}"]`);
        radios.forEach(r => r.disabled = true);
        const btn = document.querySelector(`#example${exampleNum} .btn`);
        if (btn) { btn.disabled = true; btn.style.opacity = '0.5'; }
    } else {
        result.innerText = 'Спробуй ще раз';
        result.style.color = 'brown';
    }
}

function checkAllExamples() {
    const r1 = document.getElementById('result1') ? document.getElementById('result1').innerText : '';
    const r2 = document.getElementById('result2') ? document.getElementById('result2').innerText : '';
    const r3 = document.getElementById('result3') ? document.getElementById('result3').innerText : '';
    if (r1 === 'Молодець!' && r2 === 'Молодець!' && r3 === 'Молодець!') {
        completedTopics[currentTopic] = true;
        const btn = document.querySelector(`.topic-btns .topic-btn[data-topic="${currentTopic}"]`);
        if (btn) { btn.style.opacity = '0.5'; btn.disabled = true; btn.style.pointerEvents = 'none'; }
        alert('Тема пройдена! Переходимо до вибору тем.');
        goBack();
    } else {
        alert('Спочатку правильно розв’яжи всі приклади!');
    }
}

function openFinalTest(){
    finalTestData = [];
    for (let i=0;i<4;i++){
        finalTestData.push(generatePracticeExample('add-sub', 1, 200));
    }
    for (let i=0;i<4;i++){
        finalTestData.push(generatePracticeExample('mul-div', 2, 200));
    }
    for (let i=0;i<4;i++){
        finalTestData.push(generatePracticeExample('ineq', 1, 50));
    }

    for (let i=finalTestData.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [finalTestData[i], finalTestData[j]] = [finalTestData[j], finalTestData[i]];
    }
    renderFinalTest();

    document.getElementById('finalTestBox').style.display = 'block';
    document.getElementById('topics').style.display = 'none';
    document.getElementById('theoryBox').style.display = 'none';
    document.getElementById('exampleBox').style.display = 'none';
    document.getElementById('backBtn').style.display = 'inline-block';
    document.getElementById('practiceBtn').style.display = 'none';
    document.getElementById('finalQuestions').style.display = 'inline-block';
    document.getElementById('checkFinalBtn').style.display = 'inline-block';
    document.getElementById('finalTestBox').style.display = 'inline-block';
}

function renderFinalTest(){
    const container = document.getElementById('finalQuestions');
    container.innerHTML = '';
    finalTestData.forEach((q, idx) => {
        const num = idx + 1;
        const block = document.createElement('div');
        block.className = 'example';
        block.style.marginBottom = '10px';
        const title = document.createElement('p');
        title.style.fontWeight = '600';
        title.innerText = `${num}. ${q.text}`;
        block.appendChild(title);

        const optionsDiv = document.createElement('div');
        optionsDiv.id = `finalAnswerOptions${num}`;
        q.answers.forEach(opt => {
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = `finalAnswer${num}`;
            radio.value = opt;
            radio.style.marginRight = '8px';
            label.appendChild(radio);
            label.appendChild(document.createTextNode(opt));
            optionsDiv.appendChild(label);
        });
        block.appendChild(optionsDiv);

        const res = document.createElement('p');
        res.id = `finalResult${num}`;
        res.style.marginTop = '6px';
        block.appendChild(res);

        container.appendChild(block);
    });
}

function checkFinalTest(){
    let allCorrect = true;
    let correctCount = 0;
    finalTestData.forEach((q, idx) => {
        const num = idx + 1;
        const selected = document.querySelector(`input[name="finalAnswer${num}"]:checked`);
        const resultEl = document.getElementById(`finalResult${num}`);
        if (!selected) {
            resultEl.innerText = 'Не вибрано';
            resultEl.style.color = 'orange';
            allCorrect = false;
        } else {
            if (parseInt(selected.value) === q.correct) {
                resultEl.innerText = 'Правильно';
                resultEl.style.color = 'green';
                correctCount++;
            } else {
                resultEl.innerText = `Неправильно (правильно: ${q.correct})`;
                resultEl.style.color = 'red';
                allCorrect = false;
            }
        }
    });
    if (correctCount === finalTestData.length) {
        alert(`Вітаю! Ти правильно відповів(ла) на всі ${correctCount} питань!`);
        ['add-sub','mul-div','ineq'].forEach(t => {
            completedTopics[t] = true;
            const btn = document.querySelector(`.topic-btns .topic-btn[data-topic="${t}"]`);
            if (btn) { btn.style.opacity = '0.5'; btn.disabled = true; btn.style.pointerEvents = 'none'; }
        });
    } else {
        alert(`Ти правильно відповів(ла) на ${correctCount}/${finalTestData.length}. Спробуй ще раз або повтори теми.`);
    }
}

function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

window.generatePracticeExample = generatePracticeExample;

</script>

</body>
</html>

